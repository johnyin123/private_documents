server {
    listen 9999;
    server_name _;
    location / {
        auth_request /auth;
        try_files $uri $uri/ =404;
    }
    location = /auth {
        # Using Apache as the authentication proxy
        # # curl -u user1:password http://192.168.15.30/auth/ -vvv
        proxy_pass http://192.168.15.30/auth/;
        proxy_pass_request_body off;
        proxy_set_header Content-Length "";
        proxy_set_header X-Original-URI $request_uri;
    }
}
# # Enable the Apache2 LDAP authentication module
# a2enmod authnz_ldap
<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    <Directory "/var/www/html/auth">
    Options Indexes FollowSymlinks
    AuthType Basic
    AuthName "Apache LDAP authentication"
    AuthBasicAuthoritative Off
    AuthBasicProvider ldap
    AuthLDAPURL "ldap://10.4.x.x/ou=People,dc=youcompany,dc=com?uid?sub?(objectClass=*)"
    AuthLDAPBindDN "bind@local"
    AuthLDAPBindPassword ldappassword
    Require valid-user
    </Directory>
</VirtualHost>
