cat > /etc/triggerhappy/triggers.d/sky.conf <<EOF
KEY_LEFT         1   /usr/bin/remoter.sh johnyin rewind1
KEY_RIGHT        1   /usr/bin/remoter.sh johnyin forward1
KEY_UP           1   /usr/bin/remoter.sh johnyin increase_volume
KEY_DOWN         1   /usr/bin/remoter.sh johnyin decrease_volume
KEY_SELECT       1   /usr/bin/remoter.sh johnyin play_or_pause
KEY_POWER        1   /usr/bin/remoter.sh johnyin start_stop
KEY_COMPOSE      1   /usr/bin/remoter.sh johnyin open_file
KEY_F5           1   /usr/bin/remoter.sh johnyin xsendkey Enter
KEY_ESC          1   /usr/bin/remoter.sh johnyin xsendkey Tab
KEY_VOLUMEUP     1   /usr/bin/remoter.sh johnyin xsendkey Up
KEY_VOLUMEDOWN   1   /usr/bin/remoter.sh johnyin xsendkey Down
EOF
cat > /usr/bin/remoter.sh <<EOF
#!/bin/sh
smplayer_start_stop() {
    local user=$1
    shift 1
    logger -t triggerhappy "smplayer start/stop"
    pgrep -u ${user} smplayer &&  {
        pkill -u ${user} smplayer
    } || {
        rm -f /tmp/list.pls && touch /tmp/list.pls 
        sudo systemd-run --uid=${user} -E DISPLAY=:0 smplayer /tmp/list.pls
    }
}
smplayer_action() {
    local user=$1
    shift 1
    logger -t triggerhappy "send-action start"
    pgrep -u ${user} smplayer || return 1
    sudo systemd-run --uid=${user} -E DISPLAY=:0 smplayer -send-action $*
}
smplayer_addplaylist() {
    local user=$1
    shift 1
    logger -t triggerhappy "smplayer add playlist $*"
    pgrep -u ${user} smplayer || return 1
    sudo systemd-run --uid=${user} -E DISPLAY=:0 smplayer -add-to-playlist $*
}
xsendkey() {
    # wmctrl -l
    local user=$1
    shift 1
    logger -t triggerhappy "triggerhappy xsendkey $*"
    sudo systemd-run --uid=${user} -E DISPLAY=:0 xdotool search "SMPlayer" windowactivate --sync key --clearmodifiers $*
}
case "$2" in
    start_stop)      smplayer_start_stop ${1};;
    rewind1)         smplayer_action ${1} rewind1;;
    forward1)        smplayer_action ${1} forward1;;
    play_or_pause)   smplayer_action ${1} play_or_pause;;
    increase_volume) smplayer_action ${1} increase_volume;;
    decrease_volume) smplayer_action ${1} decrease_volume;;
    xsendkey)        xsendkey ${1} ${3}
    *)  logger -t triggerhappy "Unexpected option: $1";;
esac
EOF
chmod 755 /usr/bin/remoter.sh
