#!/usr/bin/python3 -B
# -*- coding: utf-8 -*-

import database, utils, json, sys

# db.Base.metadata.drop_all(db.engine)
def usage():
    print(f'{sys.argv[0]} golds.json / hosts.json / devices.json / iso.json / vars.json')
    exit(1)

if len(sys.argv) != 2:
    usage()
fname = sys.argv[1]
clazz = {
    'golds.json'  :database.DB_KVMGold,
    'hosts.json'  :database.DB_KVMHost,
    'devices.json':database.DB_KVMDevice,
    'iso.json'    :database.DB_KVMIso,
    'vars.json'   :database.DB_KVMVar,
    }.get(fname, None)
if clazz is None:
    usage()

database.Base.metadata.create_all(database.engine)
results = json.loads(utils.file_load(fname))
database.session.query(clazz).delete()
for row in results:
    database.session.add(clazz(**row))
database.session.commit()
